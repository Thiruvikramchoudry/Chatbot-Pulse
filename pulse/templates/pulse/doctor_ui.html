{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Doctor UI</title>
    <link rel="stylesheet" href="{% static 'pulse/chatarea/styles/index.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'pulse/chatarea/images/Pulse_logo.png' %}">
    <link rel="stylesheet" href="{% static 'pulse/doctor_ui/doctor.css' %}">
</head>

<body style="position: relative;right: 8px;bottom: 8px;height: 100vh;overflow: hidden;width: 101%;z-index: 1;background: #08678d">

    <div id="preloader-1">
        <div style="position: fixed;left: 47%;top: 45%;width: 80px;height: 80px;">
                    <img src="{% static 'pulse/chatarea/images/394.gif' %}" alt="img" style="width: 100%;height: 100%;border-radius: 55px;">
        </div>
    </div>
    <div style="width: 100%;height: 100%;display: flex;">
        <div  id="side_bar">

            <div style="width: 100%;height: 50px;display: flex;justify-content: end" >
                <div style="margin:0px 17px;width: 40px;height: 40px;margin-top: 10px;border-radius: 5px;border: 1px solid white" id="scroll_button" onclick="close_sidebar()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-layout-sidebar-inset"  style="position: relative;left: 10px;top: 10px;color: white" viewBox="0 0 16 16">
  <path d="M14 2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h12zM2 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2H2z"/>
  <path d="M3 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V4z"/>
</svg>
                </div>
            </div>
            <div id="side_bar_inner">
                <img src="{% static 'pulse/home/images/Pulse_logo.png' %}" alt="img" style=" width: 100px;margin-left: 29%;border-radius: 51px;margin-bottom: 11px;margin-top: 11px;">
            <div style="width: 92%;min-height: 200px;padding: 10px;position: relative;bottom: 10px;">

                <div style="height: 34px;width: 92%;border-radius: 5px;margin-bottom: 10px;padding: 10px;background-color: #09384d;color: #20749a;"  id="side_nav_selector3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-hospital" viewBox="0 0 16 16" >
  <path d="M8.5 5.034v1.1l.953-.55.5.867L9 7l.953.55-.5.866-.953-.55v1.1h-1v-1.1l-.953.55-.5-.866L7 7l-.953-.55.5-.866.953.55v-1.1h1ZM13.25 9a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5ZM13 11.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5Zm.25 1.75a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5Zm-11-4a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5A.25.25 0 0 0 3 9.75v-.5A.25.25 0 0 0 2.75 9h-.5Zm0 2a.25.25 0 0 0-.25.25v.5c0 .138.112.25.25.25h.5a.25.25 0 0 0 .25-.25v-.5a.25.25 0 0 0-.25-.25h-.5ZM2 13.25a.25.25 0 0 1 .25-.25h.5a.25.25 0 0 1 .25.25v.5a.25.25 0 0 1-.25.25h-.5a.25.25 0 0 1-.25-.25v-.5Z"/>
  <path d="M5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1a1 1 0 0 1 1 1v4h3a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h3V3a1 1 0 0 1 1-1V1Zm2 14h2v-3H7v3Zm3 0h1V3H5v12h1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3Zm0-14H6v1h4V1Zm2 7v7h3V8h-3Zm-8 7V8H1v7h3Z"/>

</svg>
                    <span style="position: relative;bottom: 10px;">Live Chat with Clients</span>

                </div>
                <div style="width: 100%;height: 200px">
                    <button  id="close_con_div" disabled>
                        Close Conversation
                    </button>

                </div>
                <div id="user_detail" style="text-align: center;width: 100%">

                </div>
            </div>

                </div>
            <p id="display_image"  style="text-align: center;color: aliceblue"></p>
            <div style=" width: 90px;height: 80px;margin: auto" class="ready_preloader" id="preloader-2" >
                <img src="{% static 'pulse/chatarea/images/1484.gif' %}" alt="">
            </div>
        </div>
        <div id="chat_area_outer" >
            <div style="height: 100%;width: 100%;">
                <!--third chatbox-->
                <div style="height: 85%;width: 100%;overflow-y: scroll;overflow-x:hidden;padding-bottom: 9px;" id="chatbox">
                        <p style="text-align:center;color: white;margin-top: 10px" id="client_count"></p>
                        <div id="search_button" onclick="request_doctor()">
                            Appoint a Client
                        </div>
                </div>
                <form action="{% url 'getmessages20' %}" method="post" id="form_submition">
                    {% csrf_token %}
                <div style="height: 5%;width: 94%;padding: 32px;display: flex;box-shadow: 2px 2px 98px 10px black;border-radius: 72px;">

                    <div style="width: 15%;height: 40px;display: flex;justify-content: space-around" >

                        <div style="width: 35px;height: 15px;padding: 7px 16px 28px 12px;margin-right: 5px;border-radius: 10px;overflow: hidden" id="submit_message" >
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16" style="position: relative;left:4px;top: 3px;">
  <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
  <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
</svg>
                            <input type="file" style="background: antiquewhite;position: relative;bottom: 59px;width: 56px;height: 70px;right: 10px;opacity: 0;" id="image_input">

                        </div>
                        <div style="width: 35px;height: 30px;padding: 10px;margin-right: 5px;border-radius: 10px" id="submit_message">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-mic" viewBox="0 0 16 16" style="position: relative;left:4px;top: 3px;">
  <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
  <path d="M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0v5zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3z"/>
</svg>
                        </div>

                    </div>
                    <div style="width: 85%;height: 30px;display: flex" id="changable_division">
                        <div style="width: 90%">
                            <input type="text" style="width: 100%;height: 40px;border: none;border-radius: 10px 0px 0px 10px;padding: 5px;font-size: 17px" id="message_text">
                        </div>

                        <button style="width: 10%;height: 51px;padding: 5px;margin-left: 10px;border-radius: 0px 10px 10px 0px;border: none;" id="submit_message" type="submit" >
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-rocket-takeoff" viewBox="0 0 16 16" style="position: relative;left: 0px;top: 3px;">
  <path d="M9.752 6.193c.599.6 1.73.437 2.528-.362.798-.799.96-1.932.362-2.531-.599-.6-1.73-.438-2.528.361-.798.8-.96 1.933-.362 2.532Z"/>
  <path d="M15.811 3.312c-.363 1.534-1.334 3.626-3.64 6.218l-.24 2.408a2.56 2.56 0 0 1-.732 1.526L8.817 15.85a.51.51 0 0 1-.867-.434l.27-1.899c.04-.28-.013-.593-.131-.956a9.42 9.42 0 0 0-.249-.657l-.082-.202c-.815-.197-1.578-.662-2.191-1.277-.614-.615-1.079-1.379-1.275-2.195l-.203-.083a9.556 9.556 0 0 0-.655-.248c-.363-.119-.675-.172-.955-.132l-1.896.27A.51.51 0 0 1 .15 7.17l2.382-2.386c.41-.41.947-.67 1.524-.734h.006l2.4-.238C9.005 1.55 11.087.582 12.623.208c.89-.217 1.59-.232 2.08-.188.244.023.435.06.57.093.067.017.12.033.16.045.184.06.279.13.351.295l.029.073a3.475 3.475 0 0 1 .157.721c.055.485.051 1.178-.159 2.065Zm-4.828 7.475.04-.04-.107 1.081a1.536 1.536 0 0 1-.44.913l-1.298 1.3.054-.38c.072-.506-.034-.993-.172-1.418a8.548 8.548 0 0 0-.164-.45c.738-.065 1.462-.38 2.087-1.006ZM5.205 5c-.625.626-.94 1.351-1.004 2.09a8.497 8.497 0 0 0-.45-.164c-.424-.138-.91-.244-1.416-.172l-.38.054 1.3-1.3c.245-.246.566-.401.91-.44l1.08-.107-.04.039Zm9.406-3.961c-.38-.034-.967-.027-1.746.163-1.558.38-3.917 1.496-6.937 4.521-.62.62-.799 1.34-.687 2.051.107.676.483 1.362 1.048 1.928.564.565 1.25.941 1.924 1.049.71.112 1.429-.067 2.048-.688 3.079-3.083 4.192-5.444 4.556-6.987.183-.771.18-1.345.138-1.713a2.835 2.835 0 0 0-.045-.283 3.078 3.078 0 0 0-.3-.041Z"/>
  <path d="M7.009 12.139a7.632 7.632 0 0 1-1.804-1.352A7.568 7.568 0 0 1 3.794 8.86c-1.102.992-1.965 5.054-1.839 5.18.125.126 3.936-.896 5.054-1.902Z"/>
</svg>
                        </button>

                    </div>


                </div>
                </form>

            </div>


        </div>
    </div>


</body>
<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script>
    let flag=0;
    function close_sidebar(){
        if (flag==0){
            let sidebar=document.getElementById("side_bar");

            let side_bar_inner=document.getElementById("side_bar_inner")
            sidebar.id="close_side";
            side_bar_inner.style.display="none";
            let chat_area_outer=document.getElementById("chat_area_outer");
            chat_area_outer.style.width="82vw";
            flag=1;

        }else{
            let sidebar=document.getElementById("close_side");

            let side_bar_inner=document.getElementById("side_bar_inner");
            sidebar.id="side_bar";
            side_bar_inner.style.display="block";
            let chat_area_outer=document.getElementById("chat_area_outer");
            chat_area_outer.style.width="70vw";
            flag=0;
        }
    }
</script>


<script>
    let fileInput=document.getElementById("image_input");

    fileInput.addEventListener('change', (event) => {
    const selectedFile = event.target.files[0];
    const fileName = selectedFile.name;
    const fileSize = selectedFile.size;
    const fileType = selectedFile.type;
    document.getElementById("display_image").innerHTML="<b>SELECTED IMAGE: </b>"+fileName+"<span onclick='remove_pic()'> <svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-trash3' viewBox='0 0 16 16' style='color: red;cursor: pointer'> <path d='M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z'/></svg></span>";
  });
    function remove_pic(){
        document.getElementById("display_image").innerHTML="";
        document.getElementById("image_input").value="";
    }
</script>



<script>
    $(document).ready(function () {

        setInterval(function () {
            if (assigned_username!="") {


                $.ajax({
                    type: 'GET',
                    url: "getmessages2/"+assigned_username,
                    success: function (response) {

                    },
                    error: function (response) {
                        alert('An error occured')
                    }
                });
            }
        }, 1000);
    });
</script>
<script>
    function request_doctor(){
        let div=document.getElementById("chatbox");
        div.innerHTML="";
    }
    initial_message_count_2 = 0;
    $(document).ready(function () {
        setInterval(function () {
            $.ajax({
                type: 'GET',
                url: "getmessages20",
                success: function (response) {
                    count_2 = 0;
                    for (var key in response.messages) {
                        count_2 += 1;
                    }
                    console.log(count_2);

                    if (count_2 != initial_message_count_2) {


                        initial_message_count_2=count_2;
                        $("#chatbox").empty();

                        for (var key in response.messages) {
                            let message = response.messages[key][0];
                            let img_path= response.messages[key][1];
                            let chat_type=response.messages[key][2];
                            let client=response.messages[key][3];
                            let temp="";
                            if(chat_type=="user"){
                                if(img_path!=null){
                                    let static_url="{% static '' %}" + img_path;
                                    temp="<div style='width: 98%;min-height: 100px;margin-left:12px;border-radius: 20px;font-size: 13px;display: flex'> <div style='width: 350px;background: #DBEDF3;border-radius: 12px;border-radius: 20px;margin-top: 10px;color:#00818a;'> <div style='text-align: end;height: 20px;padding: 4px 16px;'> <b>~CLIENT</b></div><div style='width: 100%;'><img src='"+static_url+"' alt='img' style='width: 100%;border-radius: 3px 3px 18px 18px;'></div></div></div>"
                                    document.getElementById("chatbox").innerHTML+=temp;
                                }
                                if(message!=""){

                                    temp="<div style='width: 40%;min-height: 10px;background: #DBEDF3;padding: 20px 10px;margin-top: 8px;border-radius: 12px;color: #00818a;box-shadow: 2px 2px 95px 1px black;margin-left: 1%;font-family: monospace;font-size: 13px;'> <p style='position: relative;top: -17px;text-align: end;margin:0px;'><b>~CLIENT</b></p> <div style='width: 100%;position: relative;top: -10px;'><p style='margin:0px'>"+message+"</p></div></div>"
                                    document.getElementById("chatbox").innerHTML+=temp;
                                }
                            }else{
                                if(message!=""){
                                   temp="<div style='width: 40%;min-height: 20px;background: #00818a;padding: 20px 10px;margin-top: 10px;border-radius: 12px;color: white;box-shadow: 2px 2px 95px 1px black;margin-left: 56%;font-family: monospace;font-size: 13px;'> <p style='position: relative;top: -17px;text-align: end;margin:0px;'><b>~{{ username }}</b></p> <div style='width: 100%;position: relative;top: -10px;'><p style='margin:0px'>"+message+"</p></div></div>"
                                    document.getElementById("chatbox").innerHTML+=temp;
                                }

                            }
                            var objDiv = document.getElementById("chatbox");
                            objDiv.scrollTop = objDiv.scrollHeight+100;

                        }

                    }
                },
                error: function (response) {
                    alert('An error occured')
                }
            });
        }, 1000);
    });
</script>
<script>
    let form_ele=document.getElementById("form_submition");
    form_ele.addEventListener("submit", function(event) {
      event.preventDefault();

      var formData = new FormData(form_ele);

      // Get the image file from the input field
      var imageInput = document.getElementById("image_input"); // Replace "imageInput" with the ID of your image input field
      var imageFile = imageInput.files[0]; // Assuming you only allow a single file selection



      // Get the message value
      var message = document.getElementById("message_text").value; // Replace "messageInput" with the ID of your message input field

      // Append the image file and message to the FormData object
        let selected_chat=2;
      formData.append("image", imageFile);
      formData.append("message", message);
      formData.append("chatbox_type", selected_chat);
      document.getElementById("message_text").value="";
      remove_pic();


      // Make the AJAX request using Fetch API
      fetch("send_message_docend", {
        method: "POST",
        body: formData
      })
        .then(response => response.json())
        .then(data => {
          console.log("success");
        })
        .catch(error => {
          console.error("Error:", error);
        });
    });
</script>





</html>